{% load static i18n admin_urls %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{% block title %}{{ site_title|default:_('Django admin') }}{% endblock %}</title>

    {# Подключаем стандартные admin-css, затем наши правки #}
    <link rel="stylesheet" href="{% static 'admin/css/base.css' %}" />
    <link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}" />
    <link rel="stylesheet" href="{% static 'admin/css/admin-fixes.css' %}" />
    <script defer src="{% static 'admin/js/grappelli-custom.js' %}"></script>
    <script defer src="{% static 'admin/js/simple_admin_editor.js' %}"></script>

    {% block extrahead %}{% endblock %}
    <style>
      /* minimal inline fallback for older admin pages (won't override admin-fixes) */
      html,body{height:100%}
    </style>
</head>
<body class="pt-admin-body">
    <header class="pt-admin-topbar">
        <div class="pt-container">
            <div class="brand">
                <a href="{% url 'admin:index' %}" class="brand-link">
                    <img src="{% static 'admin/img/logo.png' %}" alt="logo" class="brand-logo" onerror="this.style.display='none'"/>
                    <span class="brand-title">{{ site_header|default:_('Site administration') }}</span>
                </a>
            </div>

            <nav class="top-actions">
                <a href="{% url 'admin:app_list' 'blog' %}" class="top-action">Блог</a>
                <a href="{% url 'admin:auth_user_changelist' %}" class="top-action">Пользователи</a>
                <a href="{% url 'admin:logout' %}" class="top-action">Выйти</a>
            </nav>
        </div>
    </header>

    <div class="pt-admin-shell">
        <aside class="pt-admin-sidebar">
            <div class="pt-container">
                {# === ВСТАВЛЕННАЯ ВИДНАЯ КНОПКА МЕДИА-БИБЛИОТЕКИ ===
                   Ссылка ведёт на именованный маршрут 'admin-media-library' (см. blog.admin).
                #}
                <div class="sidebar-section" style="padding-top:6px;">
                    <a href="{% url 'admin-media-library' %}"
                       class="btn-media-library"
                       style="display:block; background:#0d6efd; color:#fff; padding:10px 12px; border-radius:6px; text-align:center; font-weight:600; margin:6px 0; text-decoration:none; box-shadow:0 1px 0 rgba(0,0,0,0.05);">
                      <span style="display:inline-flex;align-items:center;gap:8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                          <path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M8 13l2.5 3 2-2.5L15 17" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <strong>Медиа библиотека</strong>
                      </span>
                    </a>
                </div>

                <div class="sidebar-section">
                    <h4 class="sidebar-title">Быстрые действия</h4>
                    <ul class="sidebar-list">
                        <li><a href="{% url 'admin:blog_post_add' %}">Добавить пост</a></li>
                        <li><a href="{% url 'admin:blog_category_changelist' %}">Категории</a></li>
                        <li><a href="{% url 'admin:blog_tag_changelist' %}">Теги</a></li>
                        <li><a href="{% url 'admin:blog_medialibrary_changelist' %}">Медиабиблиотека</a></li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h4 class="sidebar-title">Приложения</h4>
                    <ul class="sidebar-list small">
                        {% for app in app_list %}
                        <li class="app-item">
                          <strong>{{ app.name }}</strong>
                          <ul class="model-list">
                            {% for model in app.models %}
                              <li><a href="{{ model.admin_url }}">{{ model.name }}</a></li>
                            {% endfor %}
                          </ul>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

            </div>
        </aside>

        <main class="pt-main-content">
            <div class="pt-container">
                {% block breadcrumbs %}
                  {% if title %}
                    <div class="breadcrumbs">
                      <a href="{% url 'admin:index' %}">{% trans "Home" %}</a>
                      &nbsp;/&nbsp;<span>{{ title }}</span>
                    </div>
                  {% endif %}
                {% endblock %}

                {% block messages %}
                  {% if messages %}
                    <div class="pt-messages">
                      {% for m in messages %}
                        <div class="msg {{ m.tags }}">{{ m }}</div>
                      {% endfor %}
                    </div>
                  {% endif %}
                {% endblock %}

                {% block content %}
                {# Стандартный контент админа будет здесь #}
                {% endblock %}

            </div>
        </main>
    </div>

    <footer class="pt-admin-footer">
      <div class="pt-container">
        <small>— версия интерфейса: 1</small>
      </div>
    </footer>

    <script>
      // базовый csrf helper для клиентских вызовов
      (function(){
        function getCookie(name){let v=document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]+)');return v?v.pop():'';}
        window.ADMIN_CSRF = {csrfToken: getCookie('csrftoken')};
      })();
    </script>
    <script defer src="{% static 'admin/js/admin-global.js' %}"></script>
</body>
</html>
