{# templates/admin/widgets/tiptap_widget.html #}
{% load static %}
{# Renders a normal textarea (so admin form handling works) and
   also outputs a visual editor container that the JS will initialize. #}

{# Use the built-in textarea rendering to preserve attrs id, name etc. #}
<textarea
  name="{{ widget.name }}"
  id="{{ widget.attrs.id|default:'id_'|add:widget.name }}"
  {% for k,v in widget.attrs.items %}
    {% if k != 'id' %}
      {{ k }}="{{ v|escape }}"
    {% endif %}
  {% endfor %}
>{{ widget.value|default_if_none:''|escape }}</textarea>

{# Editor container used by JS. Data attributes mirror textarea attrs (upload/preview). #}
<div class="admin-tiptap-widget"
     data-upload-url="{{ widget.attrs.data-upload-url|default:"/api/blog/media/upload/" }}"
     data-preview-token-url="{{ widget.attrs.data-preview-token-url|default:"/admin/posts/preview-token/" }}"
     aria-hidden="false">
  <div class="tiptap-toolbar"></div>
  <div class="tiptap-editor" contenteditable="true"></div>
</div>

{# Local static JS/CSS that initialize the editor. Load only once â€” but safe to include. #}
<link rel="stylesheet" href="{% static 'admin/css/tiptap_admin.css' %}">
<script src="{% static 'admin/js/tiptap_admin_extra.js' %}"></script>
