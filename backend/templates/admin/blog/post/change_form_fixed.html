{# backend/templates/admin/blog/post/change_form_fixed.html #}
{% extends "admin/change_form.html" %}
{% load i18n static admin_urls %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/change-form.css' %}">
{% endblock %}

{% block content %}
<div class="pt-editor-page">
  <form method="post" id="post_form" enctype="multipart/form-data" novalidate>
    {% csrf_token %}

    <header class="pt-topbar">
      <div class="pt-topbar-left">
        <div class="pt-title">{% if original and original.title %}{{ original.title|truncatechars:80 }}{% else %}üìù {% trans "–ù–æ–≤—ã–π –ø–æ—Å—Ç" %}{% endif %}</div>
        <div class="pt-sub muted">{% if original and original.pk %}{% trans "ID" %}: {{ original.pk }}{% endif %}</div>
      </div>

      <div class="pt-topbar-right">
        <button type="submit" name="_save" class="pt-btn pt-btn-primary">üíæ {% trans "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" %}</button>
        <button type="submit" name="_continue" class="pt-btn">üîÅ {% trans "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å" %}</button>
        <button type="button" id="open-media-lib" class="pt-btn pt-btn-ghost">üóÇ {% trans "–ú–µ–¥–∏–∞—Ç–µ–∫–∞" %}</button>
        <a href="{% url 'admin:blog_post_changelist' %}" class="pt-btn pt-btn-ghost">{% trans "–ù–∞–∑–∞–¥" %}</a>
      </div>
    </header>

    <div class="pt-editor-grid">
      <main class="pt-main">
        <section class="pt-card">
          <div class="pt-card-header">üìå {% trans "–û—Å–Ω–æ–≤–Ω–æ–µ" %}</div>
          <div class="pt-card-body">
            <div class="pt-field">{{ adminform.form.title }}</div>
            <div class="pt-split">
              <div style="flex:1" class="pt-field">{{ adminform.form.slug }}</div>
              <div style="width:140px;display:flex;align-items:flex-end;justify-content:flex-end">
                <button type="button" id="pt-gen-slug" class="pt-btn pt-btn-outline">üîÑ {% trans "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å" %}</button>
              </div>
            </div>
          </div>
        </section>

        <section class="pt-card">
          <div class="pt-card-header">üìù {% trans "–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ" %}</div>
          <div class="pt-card-body">
            <div class="pt-field">{{ adminform.form.content }}</div>
          </div>
        </section>

        <section class="pt-card">
          <div class="pt-card-header">üìã {% trans "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" %}</div>
          <div class="pt-card-body">
            <div class="pt-field">{{ adminform.form.excerpt }}<div class="pt-charcounter"><span id="pt-excerpt-count">0</span> / 320</div></div>
          </div>
        </section>

        {% for field in adminform.form.hidden_fields %}{{ field }}{% endfor %}
      </main>

      <aside class="pt-sidebar">
        <section class="pt-card">
          <div class="pt-card-header">üöÄ {% trans "–ü—É–±–ª–∏–∫–∞—Ü–∏—è" %}</div>
          <div class="pt-card-body">
            {% if adminform.form.status %}{{ adminform.form.status }}{% endif %}
            {% if adminform.form.published_at %}{{ adminform.form.published_at }}{% endif %}
            {% if adminform.form.author %}{{ adminform.form.author }}{% endif %}
          </div>
        </section>

        <section class="pt-card">
          <div class="pt-card-header">üè∑Ô∏è {% trans "–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è" %}</div>
          <div class="pt-card-body">
            {% if adminform.form.categories %}{{ adminform.form.categories }}{% endif %}
            {% if adminform.form.tags %}{{ adminform.form.tags }}{% endif %}
          </div>
        </section>

        <section class="pt-card">
          <div class="pt-card-header">üîé {% trans "SEO" %}</div>
          <div class="pt-card-body">
            {% if adminform.form.meta_title %}<div class="pt-field">{{ adminform.form.meta_title }}</div>{% endif %}
            {% if adminform.form.meta_description %}<div class="pt-field">{{ adminform.form.meta_description }}<div class="pt-charcounter"><span id="pt-meta-count">0</span> / 160</div></div>{% endif %}
            <div style="margin-top:8px"><button type="button" id="pt-fill-seo" class="pt-btn pt-btn-outline">üìù {% trans "–ó–∞–ø–æ–ª–Ω–∏—Ç—å SEO" %}</button></div>
          </div>
        </section>

        <section class="pt-card">
          <div class="pt-card-header">üñºÔ∏è {% trans "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" %}</div>
          <div class="pt-card-body">
            {% if adminform.form.featured_image %}{{ adminform.form.featured_image }}{% endif %}
            {% if adminform.form.og_image %}{{ adminform.form.og_image }}{% endif %}
            <div style="margin-top:8px"><button type="button" id="open-media-lib-2" class="pt-btn pt-btn-outline">üóÇ {% trans "–û—Ç–∫—Ä—ã—Ç—å –º–µ–¥–∏–∞—Ç–µ–∫—É" %}</button></div>
          </div>
        </section>
      </aside>
    </div>
  </form>
</div>

{# Modal for media library #}
<div id="pt-media-modal" class="pt-modal" aria-hidden="true">
  <div class="pt-modal-backdrop" data-close></div>
  <div class="pt-modal-dialog" role="dialog" aria-modal="true">
    <div class="pt-modal-header">
      <h3>{% trans "–ú–µ–¥–∏–∞—Ç–µ–∫–∞" %}</h3>
      <button class="pt-close" data-close>‚úï</button>
    </div>
    <div class="pt-modal-body">
      <div class="pt-upload">
        <input type="file" id="pt-upload-input" accept="image/*" multiple />
        <button id="pt-upload-btn" class="pt-btn pt-btn-primary">{% trans "–ó–∞–≥—Ä—É–∑–∏—Ç—å" %}</button>
      </div>
      <div id="pt-media-grid" class="pt-media-grid"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  {{ block.super }}
  <script>
    // small safety stub to avoid 'grp is not defined' errors if any old script expects it
    if (typeof window.grp === 'undefined') {
      window.grp = { jQuery: window.jQuery || null };
    }
  </script>
  <script src="https://cdn.ckeditor.com/ckeditor5/40.2.0/classic/ckeditor.js"></script>
  <script src="{% static 'admin/js/change-form.js' %}"></script>
  <script>
    window.__pt_post_preview = {% if original and original.get_absolute_url %}"{{ original.get_absolute_url|escapejs }}"{% else %}null{% endif %};
  </script>
{% endblock %}
