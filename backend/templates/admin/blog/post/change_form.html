{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<style>
    /* Простые улучшения для лучшей организации */
    .form-row {
        margin-bottom: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
    }
    
    .form-row label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
    }
    
    .char-counter {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
        text-align: right;
    }
    
    .field-group {
        background: white;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .field-group h3 {
        margin-top: 0;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
        color: #333;
    }
    
    .image-preview {
        margin-top: 10px;
    }
    
    .image-preview img {
        max-width: 200px;
        max-height: 150px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    /* Улучшения для Grappelli */
    .grp-module {
        margin-bottom: 20px;
    }
    
    .grp-module h2 {
        background: #2c3e50;
        color: white;
        padding: 10px 15px;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="grp-module">
    {{ block.super }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Счетчики символов для важных полей
    function setupCharCounter(fieldId, maxLength) {
        const field = document.getElementById(fieldId);
        if (!field) return;
        
        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.textContent = `0/${maxLength}`;
        field.parentNode.appendChild(counter);
        
        field.addEventListener('input', function() {
            const length = this.value.length;
            counter.textContent = `${length}/${maxLength}`;
            
            if (length > maxLength) {
                counter.style.color = 'red';
            } else if (length > maxLength * 0.8) {
                counter.style.color = 'orange';
            } else {
                counter.style.color = '#666';
            }
        });
        
        // Инициализация
        field.dispatchEvent(new Event('input'));
    }
    
    // Настройка счетчиков
    setupCharCounter('id_title', 255);
    setupCharCounter('id_meta_title', 60);
    setupCharCounter('id_meta_description', 160);
    
    // Предпросмотр изображений
    function setupImagePreview(inputId) {
        const input = document.getElementById(inputId);
        if (!input) return;
        
        const preview = document.createElement('div');
        preview.className = 'image-preview';
        input.parentNode.appendChild(preview);
        
        input.addEventListener('input', function() {
            const url = this.value;
            if (url && (url.includes('.jpg') || url.includes('.png') || url.includes('.jpeg') || url.includes('.gif'))) {
                preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.style.display='none'">`;
            } else {
                preview.innerHTML = '';
            }
        });
    }
    
    setupImagePreview('id_featured_image');
    setupImagePreview('id_og_image');
    
    // Автозаполнение meta title из title
    const titleField = document.getElementById('id_title');
    const metaTitleField = document.getElementById('id_meta_title');
    
    if (titleField && metaTitleField) {
        titleField.addEventListener('blur', function() {
            if (!metaTitleField.value) {
                metaTitleField.value = this.value;
            }
        });
    }
    
    // Подсчет слов в контенте
    const contentField = document.getElementById('id_content');
    if (contentField) {
        const wordCount = document.createElement('div');
        wordCount.className = 'char-counter';
        wordCount.textContent = '0 слов';
        contentField.parentNode.appendChild(wordCount);
        
        contentField.addEventListener('input', function() {
            const text = this.value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            wordCount.textContent = `${words} слов, ~${Math.ceil(words/200)} мин чтения`;
        });
    }
});
</script>
{% endblock %}