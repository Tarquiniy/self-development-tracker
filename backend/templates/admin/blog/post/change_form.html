{% extends "admin/change_form.html" %}
{% load static i18n %}

{% block extrahead %}
  {{ block.super }}
  <!-- CKEditor bundle: —É–±–µ–¥–∏—Å—å, —á—Ç–æ CKEDITOR_BASEPATH —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ /static/ckeditor/ckeditor/ -->
  <script>
    // –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–æ—Å—Ç–∞–≤—å CKEDITOR_BASEPATH –≤ settings.py –∏–ª–∏ –≤–∫–ª—é—á–∏ —ç—Ç–æ—Ç –ø—É—Ç—å –∑–¥–µ—Å—å, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–æ–∫–∞–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É:
    window.CKEDITOR_BASEPATH = "{% static 'ckeditor/ckeditor/' %}";
  </script>
  <script src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>

  <link rel="stylesheet" href="{% static 'admin/css/admin-post-form.css' %}">
{% endblock %}

{% block content %}
<form method="post" id="post_form" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  <div class="editor-header">
    <div class="header-content">
      <div class="header-title">
        <h1>
          {% if original %}
            <span class="status-indicator {% if original.status == 'published' %}status-published{% else %}status-draft{% endif %}">
              {% if original.status == 'published' %}üì¢{% else %}üìù{% endif %}
              {{ original.get_status_display }}
            </span>
            {{ original.title|default:"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"|truncatechars:50 }}
          {% else %}
            üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞
          {% endif %}
        </h1>
      </div>
      <div class="header-actions">
        <button type="submit" name="_save" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="submit" name="_continue" class="btn btn-secondary">üîÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <a href="{% url 'admin:blog_post_changelist' %}" class="btn btn-outline">‚Üê –ù–∞–∑–∞–¥</a>
      </div>
    </div>
  </div>

  <main class="editor-main">
    <div class="content-area">
      <section class="editor-card">
        <div class="card-header"><h3>üìå –û—Å–Ω–æ–≤–Ω–æ–µ</h3></div>
        <div class="card-body">
          <div class="form-group django-field">
            <label class="form-label" for="id_title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
            {{ adminform.form.title }}
            {% if adminform.form.title.help_text %}<div class="help">{{ adminform.form.title.help_text }}</div>{% endif %}
          </div>

          <div class="form-group django-field">
            <label class="form-label" for="id_slug">Slug</label>
            {{ adminform.form.slug }}
            <div style="margin-top:6px">
              <button type="button" id="generate-slug" class="btn btn-sm btn-outline">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞</button>
              <span id="slug-preview" style="margin-left:12px;color:#666"></span>
            </div>
          </div>
        </div>
      </section>

      <section class="editor-card">
        <div class="card-header">
          <h3>üìù –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
          <div class="editor-toolbar" aria-hidden="true">
            <div class="toolbar-group">
              <button type="button" id="word-count-btn" class="btn btn-sm btn-outline">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
              <button type="button" id="auto-save-toggle" class="btn btn-sm btn-outline">üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="django-field">
            {{ adminform.form.content }}
            {% for err in adminform.form.content.errors %}
              <div class="errorlist">{{ err }}</div>
            {% endfor %}
          </div>
        </div>
      </section>

      <section class="editor-card">
        <div class="card-header"><h3>üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</h3></div>
        <div class="card-body">
          {{ adminform.form.excerpt }}
          <div class="char-counter"><span id="excerpt-counter">0</span>/320</div>
        </div>
      </section>
    </div>

    <aside class="sidebar-area">
      <div class="editor-card">
        <div class="card-header"><h3>üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h3></div>
        <div class="card-body">
          {{ adminform.form.status }}
          {{ adminform.form.published_at }}
          {{ adminform.form.author }}
        </div>
      </div>

      <div class="editor-card">
        <div class="card-header"><h3>üè∑Ô∏è –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</h3></div>
        <div class="card-body">
          {{ adminform.form.categories }}
          {{ adminform.form.tags }}
        </div>
      </div>

      <div class="editor-card">
        <div class="card-header"><h3>üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3></div>
        <div class="card-body">
          {{ adminform.form.featured_image }}
          <div style="margin-top:8px">
            <button type="button" id="open-media-lib" class="btn btn-action">üóÇ –û—Ç–∫—Ä—ã—Ç—å –º–µ–¥–∏–∞—Ç–µ–∫—É</button>
          </div>
        </div>
      </div>

      <div class="editor-card">
        <div class="card-header"><h3>üîç SEO</h3></div>
        <div class="card-body">
          {{ adminform.form.meta_title }}
          <div class="char-counter"><span id="meta-title-counter">0</span>/70</div>
          {{ adminform.form.meta_description }}
          <div class="char-counter"><span id="meta-desc-counter">0</span>/160</div>
          <div style="margin-top:8px">
            <button type="button" id="fill-meta" class="btn btn-action">üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å SEO</button>
            <button type="button" id="check-seo" class="btn btn-action">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SEO</button>
          </div>
        </div>
      </div>

      <div class="editor-card">
        <div class="card-header"><h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3></div>
        <div class="card-body">
          <div class="quick-actions">
            <button type="button" id="preview-btn" class="btn btn-action">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            <a href="{% url 'admin-media-library' %}" class="btn btn-action" target="_blank">üóÇÔ∏è –ú–µ–¥–∏–∞—Ç–µ–∫–∞</a>
          </div>
        </div>
      </div>
    </aside>
  </main>

  {% for field in adminform.form.hidden_fields %}{{ field }}{% endfor %}
</form>

<!-- Media modal (lightweight) -->
<div id="pt-media-modal" class="pt-modal" aria-hidden="true" style="display:none">
  <div class="pt-modal-backdrop" data-close></div>
  <div class="pt-modal-dialog" role="dialog" aria-modal="true">
    <div class="pt-modal-header">
      <h3>–ú–µ–¥–∏–∞—Ç–µ–∫–∞</h3>
      <button class="pt-close" data-close>‚úï</button>
    </div>
    <div class="pt-modal-body">
      <input type="file" id="pt-upload-input" accept="image/*" multiple />
      <button id="pt-upload-btn" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <div id="pt-media-grid" class="pt-media-grid"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  {{ block.super }}
  <script src="{% static 'admin/js/change-form.js' %}"></script>
  <script>
    // expose preview URL for js
    window.__pt_preview_url_for_id = function(id){
      // If object has pk => open admin preview; for new objects require save
      if (id) return '/posts/preview/' + id + '/';
      return null;
    };
  </script>
{% endblock %}
