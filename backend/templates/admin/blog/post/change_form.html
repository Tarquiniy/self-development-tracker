{% extends "admin/change_form.html" %}
{% load static i18n %}

{% block extrahead %}
  {{ block.super }}
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º TinyMCE -->
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
  <link rel="stylesheet" href="{% static 'admin/admin-modern.css' %}">
{% endblock %}

{% block content %}
  {{ block.super }}
{% endblock %}

{% block footer_extra %}
  {{ block.super }}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      tinymce.init({
        selector: 'textarea[name=content], #id_content',
        height: 650,
        menubar: true,
        plugins: 'print preview paste importcss searchreplace autolink autosave save directionality ' +
                 'code visualblocks visualchars fullscreen image link media template codesample table ' +
                 'charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount ' +
                 'imagetools textpattern noneditable help charmap quickbars emoticons',
        toolbar: 'undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | ' +
                 'alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist checklist | ' +
                 'forecolor backcolor casechange permanentpen formatpainter removeformat | ' +
                 'pagebreak | charmap emoticons | fullscreen preview save print | ' +
                 'insertfile image media link anchor codesample | ltr rtl',
        toolbar_sticky: true,

        autosave_ask_before_unload: true,
        autosave_interval: '30s',
        autosave_prefix: '{path}{query}-{id}-',
        autosave_restore_when_empty: true,
        autosave_retention: '2m',

        image_advtab: true,
        importcss_append: true,

        /* üî• –ö–∞—Å—Ç–æ–º–Ω—ã–π file picker —á–µ—Ä–µ–∑ —Ç–≤–æ—é –º–µ–¥–∏–∞—Ç–µ–∫—É */
        file_picker_callback: function (callback, value, meta) {
          let type = meta.filetype; // image / media / file
          let width = 1000;
          let height = 700;
          let win = window.open('/admin/media-library/?tinymce=1&type=' + type, 'MediaLibrary',
              'width=' + width + ',height=' + height + ',resizable=yes,scrollbars=yes');

          // –û–∂–∏–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –º–µ–¥–∏–∞—Ç–µ–∫–∏
          window.addEventListener('message', function receiveMessage(e) {
              if (e.data && e.data.source === 'media-library' && e.data.action === 'select') {
                  let att = e.data.attachment;
                  if (att && att.url) {
                      callback(att.url, { alt: att.title || '' });
                  }
                  window.removeEventListener('message', receiveMessage);
                  if (win) win.close();
              }
          });
        },

        /* üî• –®–∞–±–ª–æ–Ω—ã –±–ª–æ–∫–æ–≤ */
        templates: [
          { title: '–¶–∏—Ç–∞—Ç–∞', description: '–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ —Ü–∏—Ç–∞—Ç—ã', content: '<blockquote>–¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã</blockquote>' },
          { title: '–ó–∞–º–µ—Ç–∫–∞', description: '–í–∞–∂–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞', content: '<div class="note">–ó–∞–º–µ—Ç–∫–∞</div>' }
        ],

        quickbars_selection_toolbar: 'bold italic | quicklink h2 h3 blockquote',
        contextmenu: 'link image imagetools table',
      });
    });
  </script>
{% endblock %}
