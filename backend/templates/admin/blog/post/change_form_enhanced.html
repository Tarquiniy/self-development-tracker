{% extends "admin/change_form.html" %}
{% load static i18n %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/post_edit_enhanced.css' %}">
  <script src="{% static 'admin/js/post_edit_enhanced.js' %}"></script>
{% endblock %}

{% block field_sets %}
<div class="post-edit-container">
  <!-- Header with quick actions -->
  <div class="edit-header">
    <div class="header-left">
      <h1>
        {% if original %}
          ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: {{ original.title }}
        {% else %}
          üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞
        {% endif %}
      </h1>
      <div class="post-info">
        {% if original %}
          <span class="info-item">üÜî ID: {{ original.id }}</span>
          <span class="info-item">üìÖ –°–æ–∑–¥–∞–Ω: {{ original.created_at|date:"d.m.Y H:i" }}</span>
          <span class="info-item">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω: {{ original.updated_at|date:"d.m.Y H:i" }}</span>
        {% endif %}
      </div>
    </div>
    <div class="header-actions">
      <button type="submit" name="_save" class="btn btn-primary">
        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
      <button type="submit" name="_continue" class="btn btn-secondary">
        üîÑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
      </button>
      <a href="{% url 'admin:blog_post_changelist' %}" class="btn btn-outline">
        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
      </a>
    </div>
  </div>

  <!-- Main content grid -->
  <div class="edit-grid">
    <!-- Left column - Main content -->
    <div class="main-column">
      <!-- Title and Slug -->
      <div class="card">
        <div class="card-header">
          <h3>üìå –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name in 'title,slug' %}
              <div class="form-row{% if field.errors %} errors{% endif %}">
                {{ field.label_tag }}
                {{ field }}
                {% if field.help_text %}
                  <div class="help">{{ field.help_text|safe }}</div>
                {% endif %}
                {% if field.errors %}
                  <div class="error">{{ field.errors }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Content Editor -->
      <div class="card">
        <div class="card-header">
          <h3>üìù –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</h3>
          <div class="editor-tools">
            <button type="button" class="btn-tool" id="auto-save-toggle" title="–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ">
              üíæ Auto
            </button>
            <button type="button" class="btn-tool" id="word-count-btn" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
              üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </button>
          </div>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name == 'content' %}
              <div class="form-row editor-container">
                {{ field }}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Excerpt -->
      <div class="card">
        <div class="card-header">
          <h3>üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</h3>
          <small>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–µ–≤—å—é –∏ SEO</small>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name == 'excerpt' %}
              <div class="form-row">
                {{ field }}
                <div class="char-counter">
                  <span id="excerpt-counter">0</span>/320 —Å–∏–º–≤–æ–ª–æ–≤
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Right column - Sidebar -->
    <div class="sidebar-column">
      <!-- Publication Status -->
      <div class="card">
        <div class="card-header">
          <h3>üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h3>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name in 'status,published_at,author' %}
              <div class="form-row">
                {{ field.label_tag }}
                {{ field }}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Categories & Tags -->
      <div class="card">
        <div class="card-header">
          <h3>üè∑Ô∏è –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name in 'categories,tags' %}
              <div class="form-row">
                {{ field.label_tag }}
                {{ field }}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Featured Images -->
      <div class="card">
        <div class="card-header">
          <h3>üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name in 'featured_image,og_image' %}
              <div class="form-row">
                {{ field.label_tag }}
                {{ field }}
                {% if field.value %}
                  <div class="image-preview">
                    <img src="{{ field.value }}" alt="Preview" onerror="this.style.display='none'">
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- SEO Settings -->
      <div class="card">
        <div class="card-header">
          <h3>üîç SEO –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        </div>
        <div class="card-body">
          {% for field in adminform %}
            {% if field.name in 'meta_title,meta_description' %}
              <div class="form-row">
                {{ field.label_tag }}
                {{ field }}
                {% if field.name == 'meta_description' %}
                  <div class="char-counter">
                    <span id="meta-desc-counter">0</span>/160 —Å–∏–º–≤–æ–ª–æ–≤
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header">
          <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
        </div>
        <div class="card-body quick-actions">
          <button type="button" id="preview-btn" class="btn-action">
            üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
          </button>
          <button type="button" id="generate-slug" class="btn-action">
            üîó –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å slug
          </button>
          <button type="button" id="fill-meta" class="btn-action">
            üìù –ó–∞–ø–æ–ª–Ω–∏—Ç—å SEO
          </button>
          <a href="{% url 'admin:blog_medialibrary_changelist' %}" class="btn-action" target="_blank">
            üóÇÔ∏è –ú–µ–¥–∏–∞—Ç–µ–∫–∞
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block submit_buttons_bottom %}
<!-- Hidden - we moved submit buttons to header -->
{% endblock %}