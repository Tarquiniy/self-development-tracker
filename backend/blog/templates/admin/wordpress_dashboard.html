{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'admin/wordpress-style.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>Панель управления</h1>
    
    <div class="quick-stats">
        <div class="stat-card">
            <span class="stat-number">{{ stats.total_posts }}</span>
            <span class="stat-label">Всего постов</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.published_posts }}</span>
            <span class="stat-label">Опубликовано</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.draft_posts }}</span>
            <span class="stat-label">Черновики</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.total_comments }}</span>
            <span class="stat-label">Комментарии</span>
        </div>
        <div class="stat-card">
            <span class="stat-number">{{ stats.pending_comments }}</span>
            <span class="stat-label">На модерации</span>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
        <div>
            <!-- Recent Posts Widget -->
            <div class="dashboard-widget">
                <div class="dashboard-widget-header">
                    Последние посты
                    <a href="{% url 'admin:blog_post_add' %}" style="float: right; font-size: 12px;">Добавить новый</a>
                </div>
                <div class="dashboard-widget-content">
                    {% if stats.recent_posts %}
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for post in stats.recent_posts %}
                        <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <strong>{{ post.title }}</strong>
                            <br>
                            <small style="color: #666;">
                                {{ post.published_at|date:"d.m.Y H:i" }} | 
                                {{ post.get_status_display }}
                            </small>
                            <div style="float: right;">
                                <a href="{% url 'admin:blog_post_change' post.id %}" class="button">Редактировать</a>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>Нет постов</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quick Actions Widget -->
            <div class="dashboard-widget">
                <div class="dashboard-widget-header">Быстрые действия</div>
                <div class="dashboard-widget-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <a href="{% url 'admin:blog_post_add' %}" class="button">Новый пост</a>
                        <a href="{% url 'admin:blog_category_add' %}" class="button">Новая категория</a>
                        <a href="{% url 'admin:blog_comment_changelist' %}" class="button">Комментарии</a>
                        <a href="{% url 'admin:auth_user_add' %}" class="button">Новый пользователь</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div>
            <!-- Recent Comments Widget -->
            <div class="dashboard-widget">
                <div class="dashboard-widget-header">
                    Последние комментарии
                    <a href="{% url 'admin:blog_comment_changelist' %}" style="float: right; font-size: 12px;">Все комментарии</a>
                </div>
                <div class="dashboard-widget-content">
                    {% if stats.recent_comments %}
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        {% for comment in stats.recent_comments %}
                        <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <strong>{{ comment.author_name }}</strong> к 
                            <a href="{% url 'admin:blog_post_change' comment.post.id %}">{{ comment.post.title }}</a>
                            <br>
                            <small style="color: #666;">{{ comment.content|truncatewords:10 }}</small>
                            <div style="float: right;">
                                <a href="{% url 'admin:blog_comment_change' comment.id %}" class="button">Просмотреть</a>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>Нет комментариев</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- System Info Widget -->
            <div class="dashboard-widget">
                <div class="dashboard-widget-header">Информация о системе</div>
                <div class="dashboard-widget-content">
                    <p><strong>Django:</strong> {{ django_version }}</p>
                    <p><strong>База данных:</strong> PostgreSQL</p>
                    <p><strong>Сервер:</strong> {% if debug %}Разработка{% else %}Продакшен{% endif %}</p>
                    <p><strong>Время:</strong> {% now "d.m.Y H:i" %}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="{% static 'admin/wordpress-admin.js' %}"></script>
{% endblock %}